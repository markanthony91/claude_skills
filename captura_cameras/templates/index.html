<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de CÃ¢meras AIVisual</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="title">ğŸ¥ Dashboard de CÃ¢meras AIVisual</h1>
            <div class="header-actions">
                <button id="btnAiPanel" class="btn btn-ai">
                    <span class="icon">ğŸ¤–</span> AnÃ¡lise IA
                </button>
                <button id="btnDownload" class="btn btn-primary">
                    <span class="icon">â¬‡ï¸</span> Baixar Agora
                </button>
                <button id="btnRefresh" class="btn btn-secondary">
                    <span class="icon">ğŸ”„</span> Atualizar
                </button>
            </div>
        </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“·</div>
                    <div class="stat-info">
                        <div class="stat-value" id="statTotalCameras">-</div>
                        <div class="stat-label">Total de CÃ¢meras</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸª</div>
                    <div class="stat-info">
                        <div class="stat-value" id="statTotalStores">-</div>
                        <div class="stat-label">Lojas</div>
                    </div>
                </div>
                <div class="stat-card stat-bad">
                    <div class="stat-icon">âš ï¸</div>
                    <div class="stat-info">
                        <div class="stat-value" id="statMarkedBad">-</div>
                        <div class="stat-label">CÃ¢meras Ruins</div>
                    </div>
                </div>
                <div class="stat-card stat-good">
                    <div class="stat-icon">âœ…</div>
                    <div class="stat-info">
                        <div class="stat-value" id="statMarkedOk">-</div>
                        <div class="stat-label">CÃ¢meras OK</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ•’</div>
                    <div class="stat-info">
                        <div class="stat-value" id="statLastUpdate">-</div>
                        <div class="stat-label">Ãšltima AtualizaÃ§Ã£o</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Analysis Panel -->
    <div class="ai-panel" id="aiPanel" style="display: none;">
        <div class="container">
            <div class="ai-panel-header">
                <div class="ai-panel-title">
                    <span class="icon">ğŸ¤–</span>
                    <h3>AnÃ¡lise de Similaridade com IA</h3>
                </div>
                <button id="btnCloseAiPanel" class="btn-icon">âœ•</button>
            </div>
            <div class="ai-panel-content">
                <div class="ai-status">
                    <div class="ai-status-item">
                        <span class="ai-status-label">Status:</span>
                        <span class="ai-status-value" id="aiStatus">Verificando...</span>
                    </div>
                    <div class="ai-status-item">
                        <span class="ai-status-label">ReferÃªncias:</span>
                        <span class="ai-status-value" id="aiReferencesCount">0</span>
                    </div>
                </div>
                <div class="ai-mode-selector">
                    <label class="ai-mode-label">Modo de AnÃ¡lise:</label>
                    <div class="ai-mode-options">
                        <label class="ai-mode-option">
                            <input type="radio" name="analysisMode" value="complete" checked>
                            <span class="ai-mode-text">
                                <strong>Completo</strong>
                                <small>Detecta qualquer mudanÃ§a (pessoas, objetos, iluminaÃ§Ã£o)</small>
                            </span>
                        </label>
                        <label class="ai-mode-option">
                            <input type="radio" name="analysisMode" value="structural">
                            <span class="ai-mode-text">
                                <strong>Estrutural</strong>
                                <small>Detecta apenas mudanÃ§a de posiÃ§Ã£o/Ã¢ngulo da cÃ¢mera</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="ai-actions">
                    <button id="btnAutoLearn" class="btn btn-primary">
                        <span class="icon">ğŸ“</span> Aprender ReferÃªncias (Usar Ãšltimas)
                    </button>
                    <button id="btnManualReference" class="btn btn-primary">
                        <span class="icon">ğŸ¯</span> Selecionar ReferÃªncias Manualmente
                    </button>
                    <button id="btnAnalyzeAll" class="btn btn-secondary">
                        <span class="icon">ğŸ”</span> Analisar Todas as CÃ¢meras
                    </button>
                    <button id="btnViewReferences" class="btn btn-ghost">
                        <span class="icon">ğŸ“š</span> Ver ReferÃªncias
                    </button>
                    <button id="btnClearReferences" class="btn btn-ghost" style="color: #dc2626;">
                        <span class="icon">ğŸ—‘ï¸</span> Limpar Todas as ReferÃªncias
                    </button>
                </div>
                <div class="ai-info">
                    <p><strong>Como funciona:</strong></p>
                    <ol>
                        <li>Clique em "Aprender ReferÃªncias" para salvar as imagens atuais como padrÃ£o ideal</li>
                        <li>Clique em "Analisar Todas" para comparar imagens com as referÃªncias</li>
                        <li>Veja o score de similaridade (0-100%) em cada cÃ¢mera</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <div class="container">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filterVersion">VersÃ£o:</label>
                    <select id="filterVersion" class="filter-select">
                        <option value="latest">Apenas Ãšltimas ğŸ“¸</option>
                        <option value="all">Todas as VersÃµes ğŸ“š</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterStore">Loja:</label>
                    <select id="filterStore" class="filter-select">
                        <option value="all">Todas as Lojas</option>
                        <!-- OpÃ§Ãµes carregadas dinamicamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterQuality">Qualidade IA:</label>
                    <select id="filterQuality" class="filter-select">
                        <option value="all">Todas</option>
                        <option value="excellent">Excelentes (â‰¥90%) ğŸŒŸ</option>
                        <option value="good">Boas (â‰¥85%) âœ…</option>
                        <option value="attention">AtenÃ§Ã£o (70-84%) âš ï¸</option>
                        <option value="problems">Problemas (&lt;70%) ğŸ”´</option>
                        <option value="critical">CrÃ­ticas (&lt;50%) âŒ</option>
                        <option value="not_analyzed">NÃ£o Analisadas</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterStatus">Status Manual:</label>
                    <select id="filterStatus" class="filter-select">
                        <option value="all">Todas</option>
                        <option value="ok">Apenas OK âœ…</option>
                        <option value="bad">Marcadas Ruins âš ï¸</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="filterPosition">PosiÃ§Ã£o:</label>
                    <select id="filterPosition" class="filter-select">
                        <option value="all">Todas (P1, P2, P3)</option>
                        <option value="P1">P1</option>
                        <option value="P2">P2</option>
                        <option value="P3">P3</option>
                    </select>
                </div>

                <div class="filter-group search-group">
                    <label for="searchInput">Busca RÃ¡pida:</label>
                    <input type="text" id="searchInput" class="search-input" placeholder="Digite o nome da loja...">
                </div>

                <div class="filter-actions">
                    <button id="btnExport" class="btn btn-secondary">
                        <span class="icon">ğŸ“¥</span> Exportar Ruins
                    </button>
                    <button id="btnClearFilters" class="btn btn-ghost">
                        Limpar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Carregando cÃ¢meras...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ“­</div>
                <h2>Nenhuma cÃ¢mera encontrada</h2>
                <p>Execute o download para capturar imagens das cÃ¢meras</p>
                <button id="btnDownloadEmpty" class="btn btn-primary">
                    <span class="icon">â¬‡ï¸</span> Baixar Agora
                </button>
            </div>

            <!-- Cameras Grid -->
            <div id="camerasGrid" class="cameras-grid" style="display: none;"></div>

            <!-- Results Counter -->
            <div id="resultsCounter" class="results-counter" style="display: none;">
                Mostrando <strong id="resultsCount">0</strong> cÃ¢meras
            </div>
        </div>
    </main>

    <!-- Modal de Nota -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Adicionar Nota</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>CÃ¢mera: <strong id="modalCameraName"></strong></p>
                <textarea id="noteTextarea" class="note-textarea" placeholder="Descreva o problema encontrado..."></textarea>
            </div>
            <div class="modal-footer">
                <button id="btnCancelNote" class="btn btn-secondary">Cancelar</button>
                <button id="btnSaveNote" class="btn btn-primary">Marcar como Ruim</button>
            </div>
        </div>
    </div>

    <!-- Modal de Download -->
    <div id="downloadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“¥ Download Paralelo de CÃ¢meras</h2>
            </div>
            <div class="modal-body">
                <div class="download-progress">
                    <div class="download-info">
                        <p id="downloadStatus" class="download-status-text">Iniciando download...</p>
                        <p id="downloadCurrentCamera" class="download-camera-text"></p>
                    </div>

                    <!-- Barra de progresso -->
                    <div class="progress-bar-container">
                        <div id="downloadProgressBar" class="progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="downloadProgressPercent">0%</span>
                        <span id="downloadProgressCount">0 / 0</span>
                    </div>

                    <!-- EstatÃ­sticas -->
                    <div class="download-stats">
                        <div class="download-stat">
                            <span class="stat-label">Sucesso:</span>
                            <span id="downloadSuccess" class="stat-value success">0</span>
                        </div>
                        <div class="download-stat">
                            <span class="stat-label">Falha:</span>
                            <span id="downloadFailed" class="stat-value error">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCloseDownload" class="btn btn-secondary" style="display: none;">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="imageModal" class="modal image-modal">
        <div class="image-modal-content">
            <button class="modal-close image-modal-close">&times;</button>
            <img id="imagePreview" src="" alt="Preview">
            <div class="image-info">
                <p id="imageInfoText"></p>
            </div>
        </div>
    </div>

    <!-- View References Modal -->
    <div id="viewReferencesModal" class="modal">
        <div class="modal-content reference-modal-content">
            <div class="modal-header">
                <h2>ğŸ“š ReferÃªncias Salvas</h2>
                <button class="modal-close" id="btnCloseViewReferences">&times;</button>
            </div>
            <div class="modal-body">
                <div class="reference-stats">
                    <p>Total de referÃªncias: <strong id="viewRefTotal">0</strong></p>
                </div>

                <!-- Filtros de visualizaÃ§Ã£o -->
                <div class="reference-filters">
                    <select id="viewRefFilterStore" class="filter-select">
                        <option value="all">Todas as Lojas</option>
                    </select>
                    <select id="viewRefFilterPosition" class="filter-select">
                        <option value="all">Todas as PosiÃ§Ãµes</option>
                        <option value="P1">P1</option>
                        <option value="P2">P2</option>
                        <option value="P3">P3</option>
                    </select>
                </div>

                <!-- Grid de referÃªncias -->
                <div id="viewReferencesGrid" class="reference-grid" style="max-height: 500px; overflow-y: auto;">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCloseViewReferencesFooter" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content comparison-modal-content">
            <div class="modal-header">
                <h2>ComparaÃ§Ã£o: ReferÃªncia vs Atual</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comparison-info">
                    <p><strong id="comparisonCameraName"></strong></p>
                    <div class="comparison-score">
                        Score de Similaridade: <span id="comparisonScore" class="score-badge">-</span>
                    </div>
                </div>
                <div class="comparison-grid">
                    <div class="comparison-image-container">
                        <h3>ReferÃªncia (Ideal)</h3>
                        <img id="referenceImage" src="" alt="ReferÃªncia">
                    </div>
                    <div class="comparison-image-container">
                        <h3>Atual</h3>
                        <img id="currentImage" src="" alt="Atual">
                    </div>
                </div>
                <div class="comparison-details" id="comparisonDetails">
                    <!-- Detalhes da anÃ¡lise serÃ£o inseridos aqui -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnSetAsReference" class="btn btn-primary">
                    <span class="icon">â­</span> Usar Atual como ReferÃªncia
                </button>
                <button id="btnCloseComparison" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de SeleÃ§Ã£o Manual de ReferÃªncias -->
    <div id="referenceModal" class="modal">
        <div class="modal-content reference-modal-content">
            <div class="modal-header">
                <h2>ğŸ¯ Selecionar ReferÃªncias Manualmente</h2>
                <button class="modal-close" id="btnCloseReferenceModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="reference-instructions">
                    <p><strong>InstruÃ§Ãµes:</strong> Selecione imagens de boa qualidade para usar como referÃªncia de posiÃ§Ã£o ideal. Escolha imagens onde a cÃ¢mera estÃ¡ na posiÃ§Ã£o correta, sem obstruÃ§Ãµes.</p>
                </div>

                <!-- Dica de navegaÃ§Ã£o por teclado -->
                <div class="keyboard-hint">
                    <span><strong>ğŸ’¡ Dicas:</strong></span>
                    <span>Clique na imagem para <strong>zoom</strong></span>
                    <span>Use <kbd>EspaÃ§o</kbd> para selecionar</span>
                    <span>BotÃµes <strong>Selecionar Loja</strong> para marcar em lote</span>
                </div>

                <!-- Filtros de loja e posiÃ§Ã£o -->
                <div class="reference-filters">
                    <select id="refFilterStore" class="filter-select">
                        <option value="all">Todas as Lojas</option>
                    </select>
                    <select id="refFilterPosition" class="filter-select">
                        <option value="all">Todas as PosiÃ§Ãµes</option>
                        <option value="P1">P1</option>
                        <option value="P2">P2</option>
                        <option value="P3">P3</option>
                    </select>
                    <div class="reference-counter">
                        <span id="refSelectedCount">0</span> referÃªncias selecionadas
                    </div>
                </div>

                <!-- Modo de visualizaÃ§Ã£o -->
                <div class="reference-view-mode" style="margin-bottom: 15px;">
                    <label style="font-weight: 600; font-size: 13px;">VisualizaÃ§Ã£o:</label>
                    <button id="btnViewGrid" class="view-mode-btn active">ğŸ“‹ Grid</button>
                    <button id="btnViewByStore" class="view-mode-btn">ğŸª Por Loja</button>
                </div>

                <!-- Grid de imagens para seleÃ§Ã£o -->
                <div id="referenceGrid" class="reference-grid large-thumbs">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnSaveReferences" class="btn btn-primary">
                    <span class="icon">ğŸ’¾</span> Salvar ReferÃªncias
                </button>
                <button id="btnCancelReferences" class="btn btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Zoom de Imagem -->
    <div id="imageZoomModal" class="image-zoom-modal">
        <img id="zoomedImage" src="" alt="Zoom">
    </div>

    <!-- Modal de RevisÃ£o de ReferÃªncias Suspeitas -->
    <div id="reviewReferencesModal" class="modal">
        <div class="modal-content review-modal" style="max-width: 1400px;">
            <div class="modal-header">
                <h2>ğŸ” Revisar ReferÃªncias Suspeitas (Score < 70%)</h2>
                <button class="modal-close" id="btnCloseReviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="review-info" style="margin-bottom: 20px;">
                    <p><strong>InstruÃ§Ãµes:</strong> Revise as cÃ¢meras com score baixo. Para cada uma, decida se quer manter a referÃªncia atual, usar a nova imagem como referÃªncia, ou remover a referÃªncia.</p>
                    <p style="margin-top: 10px;"><strong>Total de cÃ¢meras suspeitas:</strong> <span id="reviewTotalCount" style="color: #dc2626; font-weight: 700;">0</span></p>
                </div>

                <div id="reviewGrid" style="max-height: 600px; overflow-y: auto;">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCloseReview" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
