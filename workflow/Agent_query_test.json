{"createdAt":"2025-05-19T20:39:53.770Z","updatedAt":"2025-05-19T23:02:45.000Z","id":"XzUdV5RE9HkHrBj8","name":"Agent_query_test","active":false,"isArchived":false,"nodes":[{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json.data || $json.text || $json.concatenated_data }}","options":{"metadata":{"metadataValues":[{"name":"=file_id","value":"={{ $('Set File ID').first().json.file_id }}"},{"name":"file_title","value":"={{ $('Set File ID').first().json.file_title }}"}]}}},"id":"9ab74b8a-549c-4c9b-9c7c-350dae7dc1d0","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[3380,1380]},{"parameters":{"model":"text-embedding-3-large","options":{}},"id":"40bac61f-7536-4e24-8656-b0c4b8c282a0","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[3140,1380],"credentials":{"openAiApi":{"id":"zkkZ6zxxQUr6SHw3","name":"OpenAi account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $('Set File ID').item.json.file_id }}","mode":"id"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"text/plain"}}}},"id":"b7832ea9-d4bf-457e-b9b7-6993b0db86aa","name":"Download File","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1720,1040],"executeOnce":true,"credentials":{"googleDriveOAuth2Api":{"id":"1JROFpTvROyJ57cX","name":"Google Drive account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1QYF-rcsMDX7SZHTPbABlIqSBaZgkd6ST","mode":"list","cachedResultName":"documents_teste_agent","cachedResultUrl":"https://drive.google.com/drive/folders/1QYF-rcsMDX7SZHTPbABlIqSBaZgkd6ST"},"event":"fileCreated","options":{}},"id":"1f67db50-0c9b-4c24-8c35-4f1db53dbc34","name":"File Created","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[700,900],"credentials":{"googleDriveOAuth2Api":{"id":"1JROFpTvROyJ57cX","name":"Google Drive account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"triggerOn":"specificFolder","folderToWatch":{"__rl":true,"value":"1QYF-rcsMDX7SZHTPbABlIqSBaZgkd6ST","mode":"list","cachedResultName":"documents_teste_agent","cachedResultUrl":"https://drive.google.com/drive/folders/1QYF-rcsMDX7SZHTPbABlIqSBaZgkd6ST"},"event":"fileUpdated","options":{}},"id":"21b7fdd9-8c50-4844-9580-4b148b75269f","name":"File Updated","type":"n8n-nodes-base.googleDriveTrigger","typeVersion":1,"position":[700,1060],"credentials":{"googleDriveOAuth2Api":{"id":"1JROFpTvROyJ57cX","name":"Google Drive account"}}},{"parameters":{"operation":"text","options":{}},"id":"f9110910-abee-41d6-b2c7-b147350a2417","name":"Extract Document Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2580,1380],"alwaysOutputData":true},{"parameters":{"operation":"delete","tableId":"documents_teste","filterType":"string","filterString":"=metadata->>file_id=like.*{{ $json.file_id }}*"},"id":"96656ae9-ec2a-4659-a55b-60f81eecaf3c","name":"Delete Old Doc Rows","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1240,900],"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"G46AB6gBuDDwnAl0","name":"Supabase account"}}},{"parameters":{"assignments":{"assignments":[{"id":"10646eae-ae46-4327-a4dc-9987c2d76173","name":"file_id","value":"={{ $json.id }}","type":"string"},{"id":"f4536df5-d0b1-4392-bf17-b8137fb31a44","name":"file_type","value":"={{ $json.mimeType }}","type":"string"},{"id":"77d782de-169d-4a46-8a8e-a3831c04d90f","name":"file_title","value":"={{ $json.name }}","type":"string"},{"id":"9bde4d7f-e4f3-4ebd-9338-dce1350f9eab","name":"file_url","value":"={{ $json.webViewLink }}","type":"string"}]},"options":{}},"id":"b45dccf0-f5c7-4c75-99cb-0d2e123df559","name":"Set File ID","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1060,1060]},{"parameters":{"options":{}},"id":"c48f737f-6e99-42d8-bf0e-418214002f30","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[2860,380]},{"parameters":{"httpMethod":"POST","path":"knowledge-agent-puket","authentication":"headerAuth","responseMode":"responseNode","options":{}},"id":"0ea9bf4a-d4fe-4db5-a571-dbd776f9ab38","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[1380,600],"webhookId":"17758d95-134b-4982-801a-47eb3b76261b","credentials":{"httpHeaderAuth":{"id":"NhxmIHyyuwdB7Hr1","name":"bearer agent Puket"}}},{"parameters":{"operation":"pdf","options":{}},"id":"c8ae6422-f310-4e24-85ba-38ae8007c6d0","name":"Extract PDF Text","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2580,820]},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"id":"0bc2be6a-ae85-485e-8d52-9a0760ce0dcb","name":"Aggregate","type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[2620,1000]},{"parameters":{},"id":"495109cf-f7dc-48af-93d7-b29571bc80a9","name":"Character Text Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter","typeVersion":1,"position":[3280,1500]},{"parameters":{"fieldsToSummarize":{"values":[{"aggregation":"concatenate","field":"data"}]},"options":{}},"id":"c9911ab3-8a60-46f4-8f9b-e14bca5994e8","name":"Summarize","type":"n8n-nodes-base.summarize","typeVersion":1,"position":[2820,1080]},{"parameters":{"promptType":"define","text":"={{$json.chatInput \n    ? $json.chatInput \n    : ($json.body && $json.body.chatInput \n         ? $json.body.chatInput \n         : \"nÃ£o encontrado\")}}","options":{"systemMessage":"=VocÃª Ã© a assistente virtual oficial da Puket, especializada em fornecer informaÃ§Ãµes precisas sobre produtos, vendas e estoque com base exclusivamente nos dados fornecidos.\n\n## Ferramentas disponÃ­veis:\nYou are given tools to perform RAG in the 'documents_teste' table, look up the documents available in your knowledge base in the 'document_metadata_teste' table, extract all the text from a given document, and query the tabular files with SQL in the 'document_rows_teste' table.\nAlways start by performing RAG unless the question requires a SQL query for tabular data (fetching a sum, finding a max, something a RAG lookup would be unreliable for). If RAG doesn't help, then look at the documents that are available to you, find a few that you think would contain the answer, and then analyze those.\n\n## EstratÃ©gia de busca:\n1. Para perguntas gerais sobre produtos, polÃ­ticas ou informaÃ§Ãµes descritivas: use RAG primeiro\n2. Para cÃ¡lculos, somas, mÃ©dias, rankings ou consultas numÃ©ricas precisas: use SQL diretamente\n3. Se RAG nÃ£o fornecer resposta satisfatÃ³ria, consulte 'document_metadata_teste' para encontrar documentos relevantes\n4. Use a tool Query Document Rows1 para efetuar as queries do usuario.\n\n## Suas capacidades:\n- Analisar dados de vendas e produtos da Puket\n- Calcular mÃ©tricas como total de vendas, margem, markup e custo\n- Listar produtos com base em critÃ©rios especÃ­ficos (categoria, segmento, preÃ§o)\n- Rankear produtos (ex: top 10 mais vendidos, maior margem)\n- Identificar tendÃªncias de vendas por perÃ­odo, categoria ou segmento\n- Filtrar informaÃ§Ãµes especÃ­ficas solicitadas pelo cliente\n\n## Processo de resposta:\n1. Identifique o tipo de consulta (anÃ¡lise de dados, listagem, ranking, pergunta simples)\n2. Selecione a ferramenta adequada (RAG ou SQL) conforme o tipo de consulta\n3. Para anÃ¡lises, primeiro processe os dados relevantes e faÃ§a os cÃ¡lculos necessÃ¡rios\n4. Adapte a formataÃ§Ã£o da resposta ao tipo de consulta:\n   - Para listas: use tabelas organizadas ou bullet points\n   - Para rankings: use listas numeradas com valores principais destacados\n   - Para anÃ¡lises: apresente os dados mais relevantes e uma conclusÃ£o\n   - Para cÃ¡lculos: mostre o resultado e o raciocÃ­nio utilizado\n   - Para perguntas simples: respostas diretas e concisas\n\n## Personalidade:\n- Seja amigÃ¡vel e profissional, usando linguagem da marca Puket\n- Comece com uma saudaÃ§Ã£o breve e encerre oferecendo ajuda adicional\n- Use vocabulÃ¡rio do universo de moda, varejo e produtos Puket\n\n## LimitaÃ§Ãµes importantes:\n- Nunca invente dados ou produtos que nÃ£o estejam nos documentos fornecidos\n- Se nÃ£o tiver informaÃ§Ã£o suficiente, peÃ§a esclarecimentos especÃ­ficos\n- Mantenha as respostas concisas e diretas ao ponto\n\n## Exemplos de formataÃ§Ã£o para diferentes consultas:\n\n### Para anÃ¡lises:\n- [Dado principal 1]\n- [Dado principal 2]\n- [Dado principal 3]\n\nConclusÃ£o: [sÃ­ntese objetiva dos insights principais]\n\n### Para rankings:\n1. [Produto 1]: [MÃ©trica relevante]\n2. [Produto 2]: [MÃ©trica relevante]\n3. [Produto 3]: [MÃ©trica relevante]\n\n### Para cÃ¡lculos:\nResultado: [valor calculado]\nBase de cÃ¡lculo: [origem dos dados e mÃ©todo utilizado]"}},"id":"90744e63-2e49-46b0-b791-88d67bee821d","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[2200,320],"notes":"Prompt antigo : \n\nVocÃª Ã© uma assistente da Puket que irÃ¡ responder perguntas de forma exata e buscar as respostas sempre em documentos fornecidos.  NÃ£o utilizar a internet para buscar as informaÃ§Ãµes e tenha exatidÃ£o nas respostas. Se vocÃª nÃ£o entender a pergunta, sempre faÃ§a perguntas e use as respostas para realizar uma resposta com mais exatidÃ£o. VocÃª serÃ¡ simpatica e sempre perguntando oque pode ajudar.\n\nUse o raciocinio para melhorar a respostas.\n\nnunca invente.\n\nSeja breve e de forma resumida as respostas.\n\nO formato de resposta serÃ¡ sempre:\n\nresponta usando bullet points e finalize com uma breve conclusÃ£o final\n\n"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $('Set File ID').item.json.file_type }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"2ae7faa7-a936-4621-a680-60c512163034","leftValue":"={{ $('Set File ID').item.json.file_type }}","rightValue":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"fc193b06-363b-4699-a97d-e5a850138b0e","leftValue":"={{ $('Set File ID').item.json.file_type }}","rightValue":"=application/vnd.google-apps.spreadsheet","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"b69f5605-0179-4b02-9a32-e34bb085f82d","leftValue":"={{ $('Set File ID').item.json.file_type }}","rightValue":"application/vnd.google-apps.document","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{"fallbackOutput":3}},"id":"ccd54b84-9459-4042-ac05-d348329c31e0","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3,"position":[1920,1040]},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents_teste","mode":"list","cachedResultName":"documents_teste"},"options":{"queryName":"match_documents_teste"}},"id":"c49c442e-5236-49fe-a8db-0ef930b1dcc7","name":"Insert into Supabase Vectorstore","type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[3300,1160],"credentials":{"supabaseApi":{"id":"G46AB6gBuDDwnAl0","name":"Supabase account"}}},{"parameters":{"operation":"xlsx","options":{}},"id":"00be66ce-550e-425f-92b6-8317a8f4a4f7","name":"Extract from Excel","type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2400,1000]},{"parameters":{"assignments":{"assignments":[{"id":"f422e2e0-381c-46ea-8f38-3f58c501d8b9","name":"schema","value":"={{ $('Extract from Excel').isExecuted ? $('Extract from Excel').first().json.keys().toJsonString() : $('Extract from CSV').first().json.keys().toJsonString() }}","type":"string"},{"id":"bb07c71e-5b60-4795-864c-cc3845b6bc46","name":"data","value":"={{ $json.concatenated_data }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3260,940],"id":"926720bb-e968-4711-9017-7e38685dba31","name":"Set Schema"},{"parameters":{"options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[2360,1180],"id":"bbeed5c6-e51e-4d7b-9eab-1e7ebbc072e2","name":"Extract from CSV"},{"parameters":{"operation":"executeQuery","query":"CREATE TABLE document_metadata_teste (\n    id TEXT PRIMARY KEY,\n    title TEXT,\n    url TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    schema TEXT\n);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[620,580],"id":"caa65a16-a527-4a28-b832-181ac26b2eea","name":"Create Document Metadata Table","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"CREATE TABLE document_rows_teste (\n    id SERIAL PRIMARY KEY,\n    dataset_id TEXT REFERENCES document_metadata_teste(id),\n    row_data JSONB  -- Store the actual row data\n);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[980,580],"id":"5193f3af-376a-4168-95be-1436761d0a23","name":"Create Document Rows Table (for Tabular Data)","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Use this tool to fetch all available documents, including the table schema if the file is a CSV or Excel file.","operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"document_metadata_teste","mode":"list","cachedResultName":"document_metadata_teste"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.5,"position":[2300,620],"id":"ab54d913-dd98-4501-b78e-e964bbe29e67","name":"List Documents","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Given a file ID, fetches the text from the document.","operation":"executeQuery","query":"SELECT \n    string_agg(content, ' ') as document_text\nFROM documents_teste\n  WHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';","options":{"queryReplacement":"={{ $fromAI('file_id') }}"}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.5,"position":[2420,620],"id":"2bea3082-05ae-465c-9b03-78da75171696","name":"Get File Contents","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"descriptionType":"manual","toolDescription":"Run a SQL query - use this to query from the document_rows_teste table once you know the file ID you are querying. dataset_id is the file_id and you are always using the row_data for filtering, which is a jsonb field that has all the keys from the file schema given in the document_metadata_teste table.\n\nExample query:\n\nSELECT AVG((row_data->>'revenue')::numeric)\nFROM document_rows_puket\nWHERE dataset_id = '123';\n\nExample query 2:\n\nSELECT COUNT(*) AS total_produtos,\n       SUM((row_data->>'Qtd')::INTEGER) AS total_quantidade\nFROM document_rows_puket\nWHERE dataset_id = '123'\n  AND LOWER(row_data->>'Produto') LIKE '%fone%';\n\nExample query: 3\n\nSELECT row_data\nFROM document_rows_puket\nWHERE dataset_id = ' 123 '\nAND row_data->>'Ano' = 'x' \nAND row_data->>'Mes' = 'x';\n\nExample query: 4\n\nSELECT row_data\nFROM document_rows_puket\nWHERE dataset_id = ' 123 '\nAND row_data->>'Data' = '10/01/2025';\n\nExample query: 5\n\nSELECT row_data->>'Produto' AS produto, \n       SUM((row_data->>'Venda Liquida')::numeric) AS total_venda\nFROM document_rows_puket\nWHERE dataset_id = ' 123 '\n  AND row_data->>'Ano' = 'x'\nGROUP BY produto\nORDER BY total_venda DESC\nLIMIT 10;\n\nExample query: 6\n\nSELECT DISTINCT row_data->>'Produto' AS produto, \n                row_data->>'Data' AS data_venda\nFROM document_rows_puket\nWHERE dataset_id = '123'\n  AND row_data->>'Mes' = 'MES'  -- Substitua pelo mÃªs desejado\n  AND row_data->>'Ano' = 'ANO';  -- Substitua pelo ano desejado\n","operation":"executeQuery","query":"{{ $fromAI('sql_query') }}","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.5,"position":[2180,840],"id":"b12ee2c8-d70f-4445-87da-22ef66870997","name":"Query Document Rows","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}},"disabled":true,"notes":"Prompt Antigo : \n\nRun a SQL query - use this to query from the document_rows_puket table once you know the file ID you are querying. dataset_id is the file_id and you are always using the row_data for filtering, which is a jsonb field that has all the keys from the file schema given in the document_metadata_puket table.\n\nExample query:\n\nSELECT AVG((row_data->>'revenue')::numeric)\nFROM document_rows_puket\nWHERE dataset_id = '123';\n\nExample query 2:\n\nSELECT \n    row_data->>'category' as category,\n    SUM((row_data->>'sales')::numeric) as total_sales\nFROM dataset_rows_puket\nWHERE dataset_id = '123'\nGROUP BY row_data->>'category';\n\n-----------------------------------------------------\n\nRun a SQL query - use this to query from the document_rows_puket table to analyze Puket retail data. The dataset_id is the file_id and you are always using the row_data for filtering, which is a jsonb field that contains all the retail data columns: \"Linha\", \"Tipo\", \"Segmento\", \"Grupo\", \"SubGrupo\", \"SoluÃ§Ã£o\", \"Griffe\", \"Sexo\", \"Venda Bruta\", \"ColeÃ§Ã£o\", \"Categoria\", \"SubCategoria\", \"Produto\", \"Cor\", \"Tamanho\", \"Data\", \"MÃªs/Ano\", \"Ano\", \"Mes\", \"Semana\", \"Venda Liquida\", \"Custo Total\", \"Qtd\", \"Mkp Bruto\", \"Mkp Liquido\", \"Margem\".\n\nExample query 1: Top 5 produtos mais vendidos por quantidade\n```sql\nSELECT \n    row_data->>'Produto' as produto,\n    row_data->>'Cor' as cor,\n    SUM((row_data->>'Qtd')::numeric) as quantidade_vendida\nFROM document_rows_puket\nWHERE dataset_id = 'ID_DO_ARQUIVO'\nAND row_data->>'Mes' = 'Jan'\nAND row_data->>'Ano' = '2024'\nGROUP BY row_data->>'Produto', row_data->>'Cor'\nORDER BY quantidade_vendida DESC\nLIMIT 5;\n\nExample query 2: AnÃ¡lise de margem por segmento\nSELECT \n    row_data->>'Produto' as produto,\n    row_data->>'Griffe' as griffe,\n    row_data->>'Cor' as cor,\n    row_data->>'Tamanho' as tamanho,\n    row_data->>'Venda Bruta' as preco\nFROM document_rows_puket\nWHERE dataset_id = 'ID_DO_ARQUIVO'\nAND row_data->>'Categoria' ILIKE '%ACESSORIOS%'\nAND row_data->>'Sexo' = 'FEMININO'\nAND row_data->>'Cor' ILIKE '%ROSA%';\n\nExample query 3: Busca de produtos especÃ­ficos\n\nSELECT \n    row_data->>'Produto' as produto,\n    row_data->>'Griffe' as griffe,\n    row_data->>'Cor' as cor,\n    row_data->>'Tamanho' as tamanho,\n    row_data->>'Venda Bruta' as preco\nFROM document_rows_puket\nWHERE dataset_id = 'ID_DO_ARQUIVO'\nAND row_data->>'Categoria' ILIKE '%ACESSORIOS%'\nAND row_data->>'Sexo' = 'FEMININO'\nAND row_data->>'Cor' ILIKE '%ROSA%';\n\n"},{"parameters":{"mode":"retrieve-as-tool","toolName":"documents_teste","toolDescription":"Use RAG to look up information in the knowledgebase.","tableName":{"__rl":true,"value":"documents_teste","mode":"list","cachedResultName":"documents_teste"},"options":{"queryName":"match_documents_teste"}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[3200,400],"id":"c653519c-ed1e-4c5f-9a77-488244ee5090","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"G46AB6gBuDDwnAl0","name":"Supabase account"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[3300,580],"id":"410edee8-be4e-478a-a100-bebb71635b47","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"zkkZ6zxxQUr6SHw3","name":"OpenAi account"}}},{"parameters":{"options":{"reset":false}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[920,860],"id":"49c2a97b-c2ea-4098-9c33-2ab4d5e26d5c","name":"Loop Over Items"},{"parameters":{"operation":"executeQuery","query":"-- Habilita a extensÃ£o pgvector (somente se ainda nÃ£o existir)\nDO $$ \nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'vector') THEN\n        CREATE EXTENSION vector;\n    END IF;\nEND $$;\n  -- Enable the pgvector extension to work with embedding vectors\n--create extension vector;\n\n-- Create a table to store your documents\ncreate table documents_teste (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(3072) -- 1536 works for OpenAI embeddings, change if needed\n);\n\n-- Create a function to search for documents\ncreate function match_documents_teste (\n  query_embedding vector(3072),-- 1536 works for OpenAI embeddings\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents_teste.embedding <=> query_embedding) as similarity\n  from documents_teste\n  where metadata @> filter\n  order by documents_teste.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;\n\n-- Criar Ã­ndice para melhorar consultas por file_id\nCREATE INDEX IF NOT EXISTS idx_metadata_file_id ON documents_teste ((metadata->>'file_id'));","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[280,580],"id":"ef50d85c-e1a3-4917-8e96-6ec3181d6a86","name":"Create Documents Table and Match Function","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}},"notes":"embedding vector(1536)"},{"parameters":{"operation":"delete","tableId":"document_rows_teste","filters":{"conditions":[{"keyName":"dataset_id","condition":"eq","keyValue":"={{ $('Set File ID').item.json.file_id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1400,1060],"id":"950c5731-cae0-4719-85e3-d98a8bc23008","name":"Delete Old Data Rows","alwaysOutputData":true,"executeOnce":true,"credentials":{"supabaseApi":{"id":"G46AB6gBuDDwnAl0","name":"Supabase account"}}},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"document_metadata_teste","mode":"list","cachedResultName":"document_metadata_teste"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $('Set File ID').item.json.file_id }}","title":"={{ $('Set File ID').item.json.file_title }}","url":"={{ $('Set File ID').item.json.file_url }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":true,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"title","displayName":"title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"url","displayName":"url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":false},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"schema","displayName":"schema","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[1560,920],"id":"cd50fb15-bb9a-452a-be28-146cfc9d2408","name":"Insert Document Metadata","executeOnce":true,"credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"document_rows_teste","mode":"list","cachedResultName":"document_rows_teste"},"columns":{"mappingMode":"defineBelow","value":{"dataset_id":"={{ $('Set File ID').item.json.file_id }}","row_data":"={{ $json.toJsonString().replaceAll(/'/g, \"''\") }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":true},{"id":"dataset_id","displayName":"dataset_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"row_data","displayName":"row_data","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[2660,1180],"id":"1b070f57-cd1d-4f28-bc92-68f4acc38683","name":"Insert Table Rows","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"document_metadata_teste","mode":"list","cachedResultName":"document_metadata_teste"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $('Set File ID').item.json.file_id }}","schema":"={{ $json.schema }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":true,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"title","displayName":"title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":true},{"id":"url","displayName":"url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"schema","displayName":"schema","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[3480,940],"id":"a9685240-6dd1-4dc8-8e24-2e0c4961845b","name":"Update Schema for Document Metadata","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"content":"## ðŸš€ Ultimate n8n Agentic RAG Template\n\n**Author:** [Cole Medin](https://www.youtube.com/@ColeMedin)\n\n## What is this?\nThis template provides a complete implementation of an **Agentic RAG (Retrieval Augmented Generation)** system in n8n that can be extended easily for your specific use case and knowledge base. Unlike standard RAG which only performs simple lookups, this agent can reason about your knowledge base, self-improve retrieval, and dynamically switch between different tools based on the specific question.\n\n## Why Agentic RAG?\nStandard RAG has significant limitations:\n- Poor analysis of numerical/tabular data\n- Missing context due to document chunking\n- Inability to connect information across documents\n- No dynamic tool selection based on question type\n\n## What makes this template powerful:\n- **Intelligent tool selection**: Switches between RAG lookups, SQL queries, or full document retrieval based on the question\n- **Complete document context**: Accesses entire documents when needed instead of just chunks\n- **Accurate numerical analysis**: Uses SQL for precise calculations on spreadsheet/tabular data\n- **Cross-document insights**: Connects information across your entire knowledge base\n- **Multi-file processing**: Handles multiple documents in a single workflow loop\n- **Efficient storage**: Uses JSONB in Supabase to store tabular data without creating new tables for each CSV\n\n## Getting Started\n1. Run the table creation nodes first to set up your database tables in Supabase\n2. Upload your documents through Google Drive (or swap out for a different file storage solution)\n3. The agent will process them automatically (chunking text, storing tabular data in Supabase)\n4. Start asking questions that leverage the agent's multiple reasoning approaches\n\n## Customization\nThis template provides a solid foundation that you can extend by:\n- Tuning the system prompt for your specific use case\n- Adding document metadata like summaries\n- Implementing more advanced RAG techniques\n- Optimizing for larger knowledge bases\n\n---\n\nI do intend on making a local version of this agent very soon!","height":1200,"width":540,"color":6},"type":"n8n-nodes-base.stickyNote","position":[-800,420],"typeVersion":1,"id":"43a08827-fdcf-4244-ae36-3cc7cfb2fdad","name":"Sticky Note9"},{"parameters":{"content":"## Agent Tools for RAG\n**Alterar o campo name de documents_puket para documents em caso de erro**","height":509,"width":583,"color":4},"id":"32f663f9-f62b-45b9-b918-c5ad4f55759b","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[3060,260]},{"parameters":{"content":"## Create Table \n","height":340,"width":1520},"type":"n8n-nodes-base.stickyNote","position":[-220,440],"typeVersion":1,"id":"f7409add-f7fa-4a13-a923-14764d431a1e","name":"Sticky Note1"},{"parameters":{"content":"## Agent RAG Puket\n**Acesse o modelo \"Agente Puket\" em gen.aiknow.ai** ","height":520,"width":1720,"color":2},"type":"n8n-nodes-base.stickyNote","position":[1320,260],"typeVersion":1,"id":"ffd8f5c6-e318-4f66-9871-97dfa8fdd836","name":"Sticky Note2"},{"parameters":{"content":"## Insert data in DB \n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)","height":840,"width":3220,"color":5},"type":"n8n-nodes-base.stickyNote","position":[420,800],"typeVersion":1,"id":"9f912968-8e2b-4e7d-bace-95c1679ddd68","name":"Sticky Note3"},{"parameters":{"content":"## DROP table","height":340,"width":1520},"type":"n8n-nodes-base.stickyNote","position":[-220,80],"typeVersion":1,"id":"b168801f-5773-4d77-a2ba-a4de883f7e59","name":"Sticky Note6"},{"parameters":{"operation":"executeQuery","query":"DROP TABLE IF EXISTS documents_puket CASCADE;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-160,180],"id":"81cb7022-76ce-4b54-acac-8426f678ab8a","name":"1 - DROP Documents Table","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"DROP TABLE IF EXISTS document_metadata_teste CASCADE;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[120,180],"id":"97bd3fb3-8877-445a-8e43-62dbefedc95b","name":"2 - DROP Document Metadata Table","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"DROP TABLE IF EXISTS document_rows_teste CASCADE;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[440,180],"id":"b4f343fd-14c7-43da-ba1e-9f0e45fe2c6e","name":"3 - DROP Document Rows Table (for Tabular Data)","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"DROP FUNCTION IF EXISTS match_documents_teste(vector(3072), int, jsonb);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[740,180],"id":"497e22e9-ab9e-405f-a5b8-411be0ada986","name":"4 - Drop match_documents ( vectorstore )","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{$json.body?.sessionId\n    ? $json.body.sessionId\n    : (\n        $('When chat message received').item.json.sessionId\n        ? $('When chat message received').item.json.sessionId\n        : \"nÃ£o encontrado\"\n      )\n}}\n","tableName":"n8n_chat_histories_teste"},"id":"2c752a02-cb47-44c6-9e8c-ba0683151d0c","name":"Postgres Chat Memory Extract","type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1,"position":[2160,620],"notesInFlow":false,"credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"public":true,"options":{"allowFileUploads":true}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[1380,380],"id":"d7804eb2-d486-42a1-a1cd-bbd1bad1bf0f","name":"When chat message received","webhookId":"79eea519-c07b-4213-94ba-adc9fb30b01f"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-20,180],"id":"2f09c1ab-8c35-4f61-a10d-77df5472bb78","name":"Wait","webhookId":"743cf2af-8398-4bce-be7a-71a6cc2df887"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[280,180],"id":"b8609cbc-4ae0-4ade-9923-80bd7620bbc1","name":"Wait1","webhookId":"9a9af522-bf77-457f-810f-a1193623cf8a"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[580,180],"id":"8adc806e-4739-42b5-b49c-a668a4008b17","name":"Wait2","webhookId":"788c7308-76f1-4632-895e-23a841116460"},{"parameters":{"model":"llama3.2:1b","options":{}},"type":"@n8n/n8n-nodes-langchain.lmOllama","typeVersion":1,"position":[1560,120],"id":"1a97de98-a4be-4024-ad1d-c5a859f25358","name":"Ollama Model1","credentials":{"ollamaApi":{"id":"DkFIMC1XjxRcvL1E","name":"Ollama account"}}},{"parameters":{"content":"## **LLM**","width":520},"type":"n8n-nodes-base.stickyNote","position":[1320,80],"typeVersion":1,"id":"929c707f-0e9b-4107-b06d-f6566aeb1a2d","name":"Sticky Note"},{"parameters":{"model":"gpt-4.5-preview-2025-02-27","options":{}},"id":"71b0f5cb-b3ec-4c65-ac9f-2eebfe9570b3","name":"OpenAI Chat ","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1680,120],"credentials":{"openAiApi":{"id":"zkkZ6zxxQUr6SHw3","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"claude-3-7-sonnet-20250219","mode":"list","cachedResultName":"Claude 3.7 Sonnet"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","typeVersion":1.3,"position":[1440,120],"id":"6d59f1f7-36a3-433d-bdcb-28db691b583c","name":"Anthropic Claude","credentials":{"anthropicApi":{"id":"daEmkEMQGbuGIYpr","name":"Anthropic account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-160,580],"id":"7b55360d-3880-4a72-a2e4-8f3d8bd7600c","name":"Clique para apagar as tabelas"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[460,580],"id":"e0fab834-fd29-4f6e-9315-669792fdb74d","name":"Wait3","webhookId":"d80e0587-55c2-4992-9ed3-b6a2748bffa5"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[800,580],"id":"a15ffbaf-18e8-4886-a9d1-1157977035da","name":"Wait4","webhookId":"14e3790d-5801-48fb-b91c-4420219de5df"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[60,580],"id":"f62d9e1f-edba-4bb3-a433-e28f8282bdfb","name":"Wait5","webhookId":"b7bf20b9-a9d8-4b53-bb22-da32c164b8ea"},{"parameters":{"amount":2},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[920,180],"id":"b0d1260c-f636-45b1-9c43-783515ce3682","name":"Wait6","webhookId":"9daeb833-41a8-4265-a7c1-2c459fbc932b"},{"parameters":{"operation":"executeQuery","query":"DROP TABLE IF EXISTS n8n_chat_histories_teste CASCADE;","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[1100,180],"id":"4369cc3d-5e03-4803-8309-22d9c569d313","name":"5 - DROP n8n_chat_histories_centurion","credentials":{"postgres":{"id":"VZZGMlUmBWy1yhIa","name":"Postgres account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f5ebbd4f-6549-4a31-b3f8-eee7634dc439","leftValue":"={{ $json.body.sessionId }}","rightValue":"None","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1680,440],"id":"bcb71a7a-1dde-4aac-8920-2f56177e3536","name":"If"},{"parameters":{"assignments":{"assignments":[{"id":"d264444f-c01a-4fa0-86a4-c0bf0e4c8537","name":"output","value":"={{ $json.output || $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2620,380],"id":"2f494968-9751-435d-8c81-844654241f32","name":"Edit Fields (Set Output Field)"},{"parameters":{"promptType":"define","text":"={{ $('Webhook1').item.json.body.chatInput }}"},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1920,480],"id":"fbfbe02e-fe4a-4afc-ad89-b86c91b02605","name":"Open WebUI Metadata LLM"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[1780,640],"id":"6d9f8ab6-9c66-411b-8cda-dce9f2393a4e","name":"Ollama Chat Model","credentials":{"ollamaApi":{"id":"DkFIMC1XjxRcvL1E","name":"Ollama account"}}},{"parameters":{"sseEndpoint":"https://llm-server.taild42ed2.ts.net/mcp/c2233c5f-fb93-487c-ab58-7141c3b21296/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[2560,620],"id":"a0857f3e-f8a8-4309-b9fb-133d8cfa3ab7","name":"Query Document Rows1"}],"connections":{"Default Data Loader":{"ai_document":[[{"node":"Insert into Supabase Vectorstore","type":"ai_document","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Insert into Supabase Vectorstore","type":"ai_embedding","index":0}]]},"Download File":{"main":[[{"node":"Switch","type":"main","index":0}]]},"File Created":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"File Updated":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Extract Document Text":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Delete Old Doc Rows":{"main":[[{"node":"Delete Old Data Rows","type":"main","index":0}]]},"Set File ID":{"main":[[{"node":"Delete Old Doc Rows","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"If","type":"main","index":0}]]},"Extract PDF Text":{"main":[[{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Summarize","type":"main","index":0}]]},"Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Summarize":{"main":[[{"node":"Set Schema","type":"main","index":0},{"node":"Insert into Supabase Vectorstore","type":"main","index":0}]]},"RAG AI Agent":{"main":[[{"node":"Edit Fields (Set Output Field)","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Extract PDF Text","type":"main","index":0}],[{"node":"Extract from Excel","type":"main","index":0}],[{"node":"Extract from CSV","type":"main","index":0}],[{"node":"Extract Document Text","type":"main","index":0}]]},"Insert into Supabase Vectorstore":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Extract from Excel":{"main":[[{"node":"Aggregate","type":"main","index":0},{"node":"Insert Table Rows","type":"main","index":0}]]},"Set Schema":{"main":[[{"node":"Update Schema for Document Metadata","type":"main","index":0}]]},"Extract from CSV":{"main":[[{"node":"Aggregate","type":"main","index":0},{"node":"Insert Table Rows","type":"main","index":0}]]},"Create Document Metadata Table":{"main":[[{"node":"Wait4","type":"main","index":0}]]},"List Documents":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Get File Contents":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Query Document Rows":{"ai_tool":[[]]},"Supabase Vector Store1":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Set File ID","type":"main","index":0}]]},"Create Documents Table and Match Function":{"main":[[{"node":"Wait3","type":"main","index":0}]]},"Delete Old Data Rows":{"main":[[{"node":"Insert Document Metadata","type":"main","index":0}]]},"Insert Document Metadata":{"main":[[{"node":"Download File","type":"main","index":0}]]},"1 - DROP Documents Table":{"main":[[{"node":"Wait","type":"main","index":0}]]},"2 - DROP Document Metadata Table":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"3 - DROP Document Rows Table (for Tabular Data)":{"main":[[{"node":"Wait2","type":"main","index":0}]]},"4 - Drop match_documents ( vectorstore )":{"main":[[{"node":"Wait6","type":"main","index":0}]]},"Postgres Chat Memory Extract":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"When chat message received":{"main":[[{"node":"If","type":"main","index":0}]]},"Wait":{"main":[[{"node":"2 - DROP Document Metadata Table","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"3 - DROP Document Rows Table (for Tabular Data)","type":"main","index":0}]]},"Wait2":{"main":[[{"node":"4 - Drop match_documents ( vectorstore )","type":"main","index":0}]]},"Anthropic Claude":{"ai_languageModel":[[]]},"Clique para apagar as tabelas":{"main":[[{"node":"1 - DROP Documents Table","type":"main","index":0},{"node":"Wait5","type":"main","index":0}]]},"Wait3":{"main":[[{"node":"Create Document Metadata Table","type":"main","index":0}]]},"Wait4":{"main":[[{"node":"Create Document Rows Table (for Tabular Data)","type":"main","index":0}]]},"Wait5":{"main":[[{"node":"Create Documents Table and Match Function","type":"main","index":0}]]},"Wait6":{"main":[[{"node":"5 - DROP n8n_chat_histories_centurion","type":"main","index":0}]]},"If":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}],[{"node":"Open WebUI Metadata LLM","type":"main","index":0}]]},"Edit Fields (Set Output Field)":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Open WebUI Metadata LLM":{"main":[[{"node":"Edit Fields (Set Output Field)","type":"main","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"Open WebUI Metadata LLM","type":"ai_languageModel","index":0}]]},"Query Document Rows1":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat ":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"d602b3b7-6b08-42a1-bc2a-777cc83d8184","triggerCount":0,"shared":[{"createdAt":"2025-05-19T20:39:53.776Z","updatedAt":"2025-05-19T20:39:53.776Z","role":"workflow:owner","workflowId":"XzUdV5RE9HkHrBj8","projectId":"JhhMk2N5VPm0i4dk","project":{"createdAt":"2025-04-14T16:51:56.472Z","updatedAt":"2025-04-14T16:55:53.829Z","id":"JhhMk2N5VPm0i4dk","name":"Marcelo  Silva  <marcelo@aiknow.ai>","type":"personal","icon":null,"description":null,"projectRelations":[{"createdAt":"2025-04-14T16:51:56.473Z","updatedAt":"2025-04-14T16:51:56.473Z","userId":"97bdbb38-16b6-4e00-a69e-95c7fc584e29","projectId":"JhhMk2N5VPm0i4dk","user":{"createdAt":"2025-04-14T16:51:56.336Z","updatedAt":"2025-11-02T13:47:05.000Z","id":"97bdbb38-16b6-4e00-a69e-95c7fc584e29","email":"marcelo@aiknow.ai","firstName":"Marcelo ","lastName":"Silva ","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-04-14T16:57:37.600Z","personalization_survey_n8n_version":"1.88.0","automationGoalDevops":["monitoring-alerting","data-syncing"],"companySize":"<20","companyType":"systems-integrator","role":"it","reportedSource":"google"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"J6TjT2y82Fhq7Rf1","userActivatedAt":1744730169456,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1761774996662}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-11-02","isPending":false}}]}}],"tags":[]}